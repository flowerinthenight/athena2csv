select                                                         
  'daily' as freq,                                       
  '2018-11-30' as calcdate,                        
  "lineitem/productcode",
  "product/region",                                
  "lineitem/usagetype",                   
  "lineitem/operation",                   
  if("lineitem/availabilityzone" is null, '', "lineitem/availabilityzone") as "lineitem/availabilityzone",
  if("product/instancetype" is null, '', "product/instancetype") as "product/instancetype",
  "lineitem/lineitemdescription",               
  sum(if("lineitem/usageamount" = '', 0, cast("lineitem/usageamount" as double))) as usageamount,
  sum(if("lineitem/blendedcost" = '', 0, cast("lineitem/blendedcost" as double))) as blended,
  sum(if("lineitem/unblendedcost" = '', 0, cast("lineitem/unblendedcost" as double))) as unblended
from "aws_billing"."mobingilabs_aws_billing_formatted_development"
where "billing_id" = '388157217682'                         
  and "year_month" = '2018-11'                       
  and "lineitem/usageaccountid" = '388157217682'      
  and substr("lineitem/usagestartdate", 1, 10) = '2018-11-30'
  and "lineitem/lineitemtype" <> 'Tax'           
group by "lineitem/productcode",                   
  "product/region",                                          
  "lineitem/usagetype",                           
  "lineitem/operation",                            
  "lineitem/availabilityzone",                     
  "product/instancetype",                                     
  "lineitem/lineitemdescription"                 
union all                                               
select                                                
  'monthly' as freq,                               
  '2018-11' as calcdate,                            
  "lineitem/productcode",                       
  "product/region",
  "lineitem/usagetype",                   
  "lineitem/operation",
  "lineitem/availabilityzone",                 
  "product/instancetype",                       
  "lineitem/lineitemdescription",                      
  sum(if("lineitem/usageamount" = '', 0, cast("lineitem/usageamount" as double))) as usageamount,
  sum(if("lineitem/blendedcost" = '', 0, cast("lineitem/blendedcost" as double))) as blended,
  sum(if("lineitem/unblendedcost" = '', 0, cast("lineitem/unblendedcost" as double))) as unblended
from "aws_billing"."mobingilabs_aws_billing_formatted_development"
where "billing_id" = '388157217682'                  
  and "year_month" = '2018-11'                        
  and "lineitem/usageaccountid" = '388157217682'   
  and "lineitem/lineitemtype" <> 'Tax'           
group by "lineitem/productcode",                   
  "product/region",                                          
  "lineitem/usagetype",
  "lineitem/operation",
  "lineitem/availabilityzone",
  "product/instancetype",
  "lineitem/lineitemdescription"
order by freq,
  calcdate,
  "lineitem/productcode",
  "product/region",
  "lineitem/usagetype",
  "lineitem/operation"
